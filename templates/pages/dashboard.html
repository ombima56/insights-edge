{{define "content"}}
<div class="dashboard">
    <div class="container">
        <div class="dashboard-header">
            <h1>Market Insights Dashboard</h1>
            <div class="dashboard-actions">
                <div class="search-container">
                    <input type="text" placeholder="Search insights..." class="search-input">
                    <button class="search-btn"><i class="fas fa-search">üîç</i></button>
                </div>
                <select id="industryFilter" onchange="filterInsights()">
                    <option value="all">All Industries</option>
                    <option value="Technology">Technology</option>
                    <option value="Retail">Retail</option>
                    <option value="Healthcare">Healthcare</option>
                    <option value="Finance">Finance</option>
                    <option value="Energy">Energy</option>
                </select>
                <button class="btn btn-primary export-btn" onclick="exportDashboardAsPDF()">Export Data</button>
            </div>
        </div>

        <!-- Key Metrics Section -->
        <div class="key-metrics">
            <div class="metric-card">
                <div class="metric-icon">üìà</div>
                <div class="metric-content">
                    <h3>Market Growth</h3>
                    <div class="metric-value">+24.8%</div>
                    <div class="metric-change positive">‚Üë 3.2% from last month</div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-icon">üë•</div>
                <div class="metric-content">
                    <h3>New Competitors</h3>
                    <div class="metric-value">12</div>
                    <div class="metric-change negative">‚Üë 4 from last quarter</div>
                </div>
            </div>
            <div class="metric-card">
                <div class="metric-icon">üí∞</div>
                <div class="metric-content">
                    <h3>Investment Opportunity</h3>
                    <div class="metric-value">$1.2B</div>
                    <div class="metric-change positive">‚Üë 18.5% YoY</div>
                </div>
            </div>
        </div>

        <div class="dashboard-grid">
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Industry Growth Trends</h3>
                    <div class="card-actions">
                        <button class="btn-icon" onclick="toggleChartView('growthChart', 'line')">üìà</button>
                        <button class="btn-icon" onclick="toggleChartView('growthChart', 'bar')">üìä</button>
                        <div class="dropdown">
                            <button class="btn-icon">‚ãÆ</button>
                            <div class="dropdown-content">
                                <a href="#" onclick="downloadChart('growthChart')">Download</a>
                                <a href="#" onclick="shareChart('growthChart')">Share</a>
                                <a href="#" onclick="fullscreenChart('growthChart')">Fullscreen</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="growthChart"></canvas>
                </div>
                <div class="real-time-indicator">
                    <span class="pulse"></span> Real-time data
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Market Share Distribution</h3>
                    <div class="card-actions">
                        <button class="btn-icon" onclick="toggleChartView('marketShareChart', 'doughnut')">üç©</button>
                        <button class="btn-icon" onclick="toggleChartView('marketShareChart', 'pie')">ü•ß</button>
                        <div class="dropdown">
                            <button class="btn-icon">‚ãÆ</button>
                            <div class="dropdown-content">
                                <a href="#" onclick="downloadChart('marketShareChart')">Download</a>
                                <a href="#" onclick="shareChart('marketShareChart')">Share</a>
                                <a href="#" onclick="fullscreenChart('marketShareChart')">Fullscreen</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="marketShareChart"></canvas>
                </div>
                <div class="chart-legend">
                    <div class="legend-item"><span class="color-dot" style="background-color: #6366f1"></span>Technology (40%)</div>
                    <div class="legend-item"><span class="color-dot" style="background-color: #818cf8"></span>Retail (35%)</div>
                    <div class="legend-item"><span class="color-dot" style="background-color: #10b981"></span>Healthcare (25%)</div>
                </div>
            </div>
            
            <div class="dashboard-card">
                <div class="card-header">
                    <h3>Investment Trends</h3>
                    <div class="card-actions">
                        <button class="btn-icon" onclick="toggleChartView('investmentChart', 'bar')">üìä</button>
                        <button class="btn-icon" onclick="toggleChartView('investmentChart', 'line')">üìà</button>
                        <div class="dropdown">
                            <button class="btn-icon">‚ãÆ</button>
                            <div class="dropdown-content">
                                <a href="#" onclick="downloadChart('investmentChart')">Download</a>
                                <a href="#" onclick="shareChart('investmentChart')">Share</a>
                                <a href="#" onclick="fullscreenChart('investmentChart')">Fullscreen</a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="investmentChart"></canvas>
                </div>
                <div class="insight-summary">
                    <p>Q4 shows <strong>61% growth</strong> in investments compared to Q1, indicating strong market confidence.</p>
                </div>
            </div>
        </div>

        <!-- Predictive Insights Section -->
        <div class="predictive-insights">
            <h2>Summarized Predictive Insights</h2>
            <div class="insights-grid">
                <div class="insight-card">
                    <div class="insight-header">
                        <div class="insight-icon">üîÆ</div>
                        <h3>Market Prediction</h3>
                    </div>
                    <p>Based on current trends, we predict a <strong>32% growth</strong> in the Technology sector over the next quarter, with particular strength in AI and cloud services.</p>
                    <div class="confidence-meter">
                        <div class="confidence-label">Confidence: 87%</div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: 87%"></div>
                        </div>
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-header">
                        <div class="insight-icon">‚ö†Ô∏è</div>
                        <h3>Risk Alert</h3>
                    </div>
                    <p>Potential regulatory changes in the Healthcare sector may impact growth projections. Monitor developments in telemedicine legislation.</p>
                    <div class="confidence-meter">
                        <div class="confidence-label">Risk Level: Medium</div>
                        <div class="confidence-bar">
                            <div class="confidence-fill warning" style="width: 65%"></div>
                        </div>
                    </div>
                </div>
                <div class="insight-card">
                    <div class="insight-header">
                        <div class="insight-icon">üí°</div>
                        <h3>Opportunity Spotlight</h3>
                    </div>
                    <p>Emerging market gap identified in sustainable retail solutions. Early movers can capture up to <strong>15% market share</strong> within 6 months.</p>
                    <div class="confidence-meter">
                        <div class="confidence-label">Opportunity Score: 92%</div>
                        <div class="confidence-bar">
                            <div class="confidence-fill success" style="width: 92%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="insights-table-container">
            <div class="table-header">
                <h2>Latest Market Insights</h2>
                <div class="table-actions">
                    <button class="btn btn-secondary refresh-btn">Refresh Data</button>
                    <div class="view-toggle">
                        <button class="btn-icon active" data-view="table">üìã</button>
                        <button class="btn-icon" data-view="cards">üÉè</button>
                    </div>
                </div>
            </div>
            <table class="insights-table">
                <thead>
                    <tr>
                        <th>Industry <span class="sort-icon">‚ÜïÔ∏è</span></th>
                        <th>Title <span class="sort-icon">‚ÜïÔ∏è</span></th>
                        <th>Description</th>
                        <th>Trend Value <span class="sort-icon">‚ÜïÔ∏è</span></th>
                        <th>Date <span class="sort-icon">‚ÜïÔ∏è</span></th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .Insights}}
                    <tr>
                        <td><span class="industry-badge {{.Industry}}">{{.Industry}}</span></td>
                        <td>{{.Title}}</td>
                        <td>{{.Description}}</td>
                        <td><span class="trend-value {{if ge .TrendValue 0.0}}positive{{else}}negative{{end}}">{{.TrendValue}}%</span></td>
                        <td>{{.CreatedAt}}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn-icon">üëÅÔ∏è</button>
                                <button class="btn-icon">üìä</button>
                                <button class="btn-icon">‚¨áÔ∏è</button>
                            </div>
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
// Initialize charts with dummy data
document.addEventListener('DOMContentLoaded', function() {
    // Define filterInsights function at the beginning
    window.filterInsights = function() {
        const industry = document.getElementById('industryFilter').value;
        console.log('Filtering insights for industry:', industry);
        
        // Animation for filtering
        const tableRows = document.querySelectorAll('.insights-table tbody tr');
        tableRows.forEach(row => {
            const rowIndustry = row.querySelector('.industry-badge').textContent;
            if (industry === 'all' || rowIndustry === industry) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
            
            // Animation effect
            row.style.opacity = '0.5';
            row.style.transform = 'translateY(10px)';
        });
        
        setTimeout(() => {
            tableRows.forEach(row => {
                if (row.style.display !== 'none') {
                    row.style.opacity = '1';
                    row.style.transform = 'translateY(0)';
                }
            });
        }, 300);
    };

    // Export dashboard as PDF function
    window.exportDashboardAsPDF = function() {
        // Show loading indicator
        const loadingOverlay = document.createElement('div');
        loadingOverlay.className = 'loading-overlay';
        loadingOverlay.innerHTML = '<div class="loading-spinner"></div><p>Generating PDF...</p>';
        document.body.appendChild(loadingOverlay);
        
        // Get the dashboard content
        const dashboardContent = document.querySelector('.dashboard');
        
        // Clone the dashboard to avoid modifying the original
        const dashboardClone = dashboardContent.cloneNode(true);
        
        // Remove any interactive elements that shouldn't be in the PDF
        const elementsToRemove = dashboardClone.querySelectorAll('.theme-toggle, .search-container, .export-btn');
        elementsToRemove.forEach(el => el.remove());
        
        // Set PDF options
        const options = {
            margin: 10,
            filename: 'insights-edge-dashboard.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true, logging: false },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
        };
        
        // Generate the PDF
        html2pdf().from(dashboardClone).set(options).save().then(() => {
            // Remove loading overlay when done
            document.body.removeChild(loadingOverlay);
        }).catch(error => {
            console.error('Error generating PDF:', error);
            document.body.removeChild(loadingOverlay);
            alert('Failed to generate PDF. Please try again.');
        });
    };

    // Growth Trends Chart
    const growthCtx = document.getElementById('growthChart').getContext('2d');
    window.growthChart = new Chart(growthCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Technology',
                data: [30, 35, 45, 55, 59, 65],
                borderColor: '#6366f1',
                backgroundColor: 'rgba(99, 102, 241, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'Retail',
                data: [25, 30, 35, 40, 45, 50],
                borderColor: '#818cf8',
                backgroundColor: 'rgba(129, 140, 248, 0.1)',
                tension: 0.4,
                fill: true
            }, {
                label: 'Healthcare',
                data: [20, 25, 30, 40, 45, 55],
                borderColor: '#10b981',
                backgroundColor: 'rgba(16, 185, 129, 0.1)',
                tension: 0.4,
                fill: true
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                },
                tooltip: {
                    mode: 'index',
                    intersect: false,
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawBorder: false,
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            },
            animation: {
                duration: 2000,
                easing: 'easeOutQuart'
            }
        }
    });

    // Market Share Chart
    const marketShareCtx = document.getElementById('marketShareChart').getContext('2d');
    window.marketShareChart = new Chart(marketShareCtx, {
        type: 'doughnut',
        data: {
            labels: ['Technology', 'Retail', 'Healthcare'],
            datasets: [{
                data: [40, 35, 25],
                backgroundColor: ['#6366f1', '#818cf8', '#10b981'],
                borderWidth: 0,
                hoverOffset: 15
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return context.label + ': ' + context.raw + '%';
                        }
                    }
                }
            },
            cutout: '70%',
            animation: {
                animateRotate: true,
                animateScale: true
            }
        }
    });

    // Investment Trends Chart
    const investmentCtx = document.getElementById('investmentChart').getContext('2d');
    window.investmentChart = new Chart(investmentCtx, {
        type: 'bar',
        data: {
            labels: ['Q1', 'Q2', 'Q3', 'Q4'],
            datasets: [{
                label: 'Investment (millions)',
                data: [150, 230, 180, 290],
                backgroundColor: [
                    'rgba(99, 102, 241, 0.7)',
                    'rgba(99, 102, 241, 0.8)',
                    'rgba(99, 102, 241, 0.9)',
                    'rgba(99, 102, 241, 1.0)'
                ],
                borderRadius: 6
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            return '$' + context.raw + 'M';
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        drawBorder: false,
                    }
                },
                x: {
                    grid: {
                        display: false
                    }
                }
            },
            animation: {
                delay: function(context) {
                    return context.dataIndex * 300;
                }
            }
        }
    });

    // Add animation to metric cards
    const metricCards = document.querySelectorAll('.metric-card');
    metricCards.forEach((card, index) => {
        setTimeout(() => {
            card.classList.add('animate-in');
        }, index * 200);
    });

    // Add animation to insight cards
    const insightCards = document.querySelectorAll('.insight-card');
    insightCards.forEach((card, index) => {
        setTimeout(() => {
            card.classList.add('animate-in');
        }, 500 + index * 200);
    });

    // Simulate real-time data updates
    setInterval(updateRandomData, 5000);
});

function updateRandomData() {
    // Update a random data point in the growth chart
    const datasetIndex = Math.floor(Math.random() * window.growthChart.data.datasets.length);
    const dataIndex = Math.floor(Math.random() * window.growthChart.data.datasets[datasetIndex].data.length);
    const newValue = window.growthChart.data.datasets[datasetIndex].data[dataIndex] + (Math.random() > 0.5 ? 1 : -1) * Math.random() * 5;
    window.growthChart.data.datasets[datasetIndex].data[dataIndex] = Math.max(0, newValue);
    window.growthChart.update();
    
    // Flash the real-time indicator
    const indicators = document.querySelectorAll('.real-time-indicator');
    indicators.forEach(indicator => {
        indicator.classList.add('flash');
        setTimeout(() => {
            indicator.classList.remove('flash');
        }, 1000);
    });
}

function toggleChartView(chartId, type) {
    const chart = window[chartId];
    if (chart) {
        chart.config.type = type;
        chart.update();
    }
}

function downloadChart(chartId) {
    console.log('Downloading chart:', chartId);
    alert('Chart download started');
}

function shareChart(chartId) {
    console.log('Sharing chart:', chartId);
    alert('Chart sharing options opened');
}

function fullscreenChart(chartId) {
    console.log('Fullscreen chart:', chartId);
    alert('Chart opened in fullscreen mode');
}
</script>
{{end}}
